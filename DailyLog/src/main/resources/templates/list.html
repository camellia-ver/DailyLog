<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>일기 목록 · DailyLog</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link href="css/styles.css" rel="stylesheet">
</head>
<body>
<div id="nav-include" th:replace="~{fragments/nav :: navbar}"></div>

<main class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5>일기 목록</h5>
        <div class="small text-muted">달력 / 리스트 뷰</div>
    </div>

    <div class="row">
        <div class="col-lg-4">
            <div class="card p-3">
                <div class="small text-muted mb-2">달력</div>
                <div class="border rounded p-3 text-center">
                    <!-- 달력 input 추가 -->
                    <input type="text" id="myCalendar" placeholder="날짜 선택" class="form-control">

                    <div class="mt-3">
                       <span id="selectedDateBadge"
                             class="badge"
                             th:classappend="${diary != null} ? ' bg-warning' : ' bg-secondary'"
                             th:text="${diaryEmotion != null ? today + ' · ' + diaryEmotion.emoji + ' ' + diaryEmotion.description
                                       : today + ' · 아직 작성되지 않음'}">
                            10월 10일 · 🙂
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-8">
            <div class="list-group">
                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action" th:if="${diary != null}">
                        <div class="fw-semibold"
                             th:text="${diaryEmotion != null ? today + ' · ' + diaryEmotion.emoji + ' ' + diaryEmotion.description
                                      : today + ' · 아직 작성되지 않음'}">
                            2025-10-10 · 😊 행복
                        </div>
                        <div class="small text-muted" th:text="${#strings.abbreviate(diary.content, 20)}">
                            짧은 미리보기: 오늘은 즐거운 하루였어...
                        </div>
                    </a>

                    <!-- diary가 없을 때 -->
                    <div th:if="${diary == null}" class="text-muted p-3">
                        오늘은 아직 일기가 작성되지 않았습니다.
                    </div>
                </div>

                <!-- ✅ diary가 있을 때만 수정 폼 보이기 -->
                <div class="card p-3 mb-3" th:if="${diary != null}">
                    <h5 class="mb-3">일기 수정</h5>
                    <form id="editDiaryForm">
                        <input type="hidden" name="today" th:value="${today}" id="todayInput">
                        <input type="hidden" id="diaryId" th:value="${diary != null ? diary.id : ''}">

                        <div class="mb-3">
                            <label for="diaryMood" class="form-label">기분</label>
                            <select class="form-select" id="diaryMood">
                                <option value="happy" th:selected="${diary.emotion == 'happy'}">😊 행복</option>
                                <option value="sad" th:selected="${diary.emotion == 'sad'}">😢 슬픔</option>
                                <option value="angry" th:selected="${diary.emotion == 'angry'}">😡 화남</option>
                                <option value="calm" th:selected="${diary.emotion == 'calm'}">😌 편안</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="diaryContent" class="form-label">내용</label>
                            <textarea id="diaryContent"
                                      class="form-control"
                                      maxlength="500"
                                      th:text="${diary.content}"></textarea>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-primary" id="btnEdit">수정</button>
                            <button type="button" class="btn btn-danger" id="btnDelete">삭제</button>
                        </div>
                    </form>
                </div>

                <div th:if="${isToday} and ${diary == null}" class="card p-3 mb-3">
                    <div class="d-flex gap-2">
                        <a href="/diary" class="btn">일기 쓰러 가기</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

</main>
<div id="footer-include" th:replace="~{fragments/footer :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/list.js"></script>
<script src="js/scripts.js"></script>
</body>
</html>